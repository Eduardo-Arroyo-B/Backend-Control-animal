generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuarios {
  usuario_id      String          @id @default(uuid()) @db.Uuid
  username        String          @unique
  password        String
  email           String          @unique
  nombre_completo String
  rol_id          String          @db.Uuid
  estatus_usuario Estatus_Usuario
  ultimo_acceso   DateTime

  // Relaciones
  Rol                       Rol                       @relation(fields: [rol_id], references: [id])
  Integraciones             Integraciones_Log[]
  EvaluacionesComoEvaluador Evaluaciones_Adopcion[]   @relation("EvaluadorRelation")
  EvaluacionesAprobadas     Evaluaciones_Adopcion[]   @relation("AprobadoRelation")
  Desparacitaciones         Desparasitaciones[]
  Adopciones                Adopciones[]
  Seguimiento_Adopciones    Seguimientos_Adopciones[]
  Mordeduras                Mordeduras[]
  Esterilizaciones          Esterilizaciones[]
  Vacunaciones              Vacunaciones[]
  Animal                    Animales[]
  Inventario_Medicamentos   Inventario_Medicamentos[]
  Inventario_Alimentos      Inventario_Alimento[]
  Movimientos_Inventario    Movimientos_Inventario[]
  Auditoria                 Auditoria[]
  Consultas_Veterinarias    Consultas_Veterinarias[]
  Reporte_Seguimiento       Reporte_Seguimiento[]

  @@index([rol_id])
  @@index([estatus_usuario])
  @@index([ultimo_acceso])
  @@index([username])
}

model Rol {
  id       String @id @default(uuid()) @db.Uuid
  nombre   String @unique
  permisos Json

  Usuarios Usuarios[]
}

model Reportes_Ciudadanos {
  reporte_id      Int      @id @default(autoincrement())
  folio_reporte   String   @unique
  tipo_reporte    String
  descripcion     String
  ubicacion       String
  colonia         String
  prioridad       String
  estatus_reporte String   @default("Pendiente")
  fecha_reporte   DateTime
  asignado_a      String

  // Relaciones
  Reporte_Seguimiento Reporte_Seguimiento[]

  @@index([estatus_reporte])
  @@index([prioridad])
  @@index([fecha_reporte])
  @@index([asignado_a])
}

model Integraciones_Log {
  id                String   @id @default(uuid()) @db.Uuid
  sistema_externo   String
  tipo_operacion    String
  exitoso           Boolean
  usuarios_id       String   @db.Uuid
  fecha_integracion DateTime @default(now())

  // Relaciones
  Usuarios Usuarios @relation(fields: [usuarios_id], references: [usuario_id])

  @@index([usuarios_id])
  @@index([fecha_integracion])
  @@index([sistema_externo])
  @@index([exitoso])
}

model Vacunaciones {
  id               Int      @id @default(autoincrement())
  animal_id        Int
  vacuna_id        Int
  lote             String
  fecha_aplicacion DateTime
  proxima_dosis    DateTime
  observaciones    String
  veterinario_Id   String   @db.Uuid

  // Relaciones
  Animal   Animales           @relation(fields: [animal_id], references: [animal_id])
  Usuarios Usuarios           @relation(fields: [veterinario_Id], references: [usuario_id])
  Vacuna   Inventario_Vacunas @relation(fields: [vacuna_id], references: [id])

  @@index([animal_id])
  @@index([vacuna_id])
  @@index([veterinario_Id])
  @@index([fecha_aplicacion])
}

model Animales {
  animal_id        Int    @id @default(autoincrement())
  nombre           String
  especie          String
  Raza             String
  edad             String
  pelaje           String
  peso             Int
  numero_microchip String
  tipo_ingreso     String
  ubicacion_actual String
  estado_salud     String
  sexo             String
  observaciones    String

  // aparte
  fecha_ingreso           DateTime
  es_adoptable            Boolean
  autorizado_adopcion_por String   @db.Uuid

  // Relaciones
  Usuarios               Usuarios                 @relation(fields: [autorizado_adopcion_por], references: [usuario_id])
  Evaluaciones_Adopcion  Evaluaciones_Adopcion[]
  Desparacitaciones      Desparasitaciones[]
  Egresos_Animales       Egresos_Animales[]
  Adopciones             Adopciones[]
  Ingresos_Animales      Ingresos_Animales[]
  Animales_Fotos         Animales_Fotos[]
  Animales_Documentos    Animales_Documentos[]
  Mordeduras             Mordeduras[]
  Defunciones            Defunciones[]
  Esterilizaciones       Esterilizaciones[]
  Vacunaciones           Vacunaciones[]
  Consultas_Veterinarias Consultas_Veterinarias[]

  // Avisar Alan
  @@index([es_adoptable])
  @@index([fecha_ingreso])
  @@index([autorizado_adopcion_por])
}

model Propietario {
  propietario_id        String   @id @default(uuid()) @db.Uuid
  tipo_identificacion   String
  numero_identificacion String   @unique
  nombre                String
  apellido_paterno      String
  apellido_materno      String
  fecha_nacimiento      DateTime
  genero                String
  email                 String
  telefono              String
  colonia               String
  estatus_propietario   String

  // Relaciones
  Adopciones                      Adopciones[]
  Mordeduras                      Mordeduras[]
  Propietario_Documentos          Propietario_Documentos[]
  Historial_Servicios_Propietario Historial_Servicios_Propietario[]
  Pago_Servicios                  Pagos_Servicios[]
  Esterilizaciones                Esterilizaciones[]
}

// Sin uso
model Cat_Razas {
  id             Int    @id @default(autoincrement())
  especie_animal String
  nombre_raza    String
}

model Inventario_Vacunas {
  id                  Int      @id @default(autoincrement())
  nombre_vacuna       String
  lote                String
  cantidad_disponible Int
  unidad_medida       String
  fecha_vencimiento   DateTime
  stock_alerta        Int

  // Relaciones
  Vacunaciones Vacunaciones[]
}

model Inventario_Medicamentos {
  medicamentos_id      Int      @id @default(autoincrement())
  nombre_medicamento   String
  fecha_vencimiento    DateTime
  cantidad_disponibles Int
  unidad_medida        Int
  registrado_por       String   @db.Uuid

  // Relaciones
  Usuarios Usuarios @relation(fields: [registrado_por], references: [usuario_id])
}

model Inventario_Alimento {
  alimento_id            Int      @id @default(autoincrement())
  nombre_producto        String
  tipo_alimento          String
  fecha_vencimiento      DateTime
  cantidad_disponible_kg Int
  registrado_por         String   @db.Uuid

  // Relaciones
  Usuarios Usuarios @relation(fields: [registrado_por], references: [usuario_id])
}

model Movimientos_Inventario {
  movimiento_Id   Int    @id @default(autoincrement())
  tipo_inventario String
  item_id         Int
  tipo_movimiento String
  cantidad        Int
  responsable     String @db.Uuid

  // Relaciones
  Usuarios Usuarios @relation(fields: [responsable], references: [usuario_id])
}

model Auditoria {
  auditoria_id     Int      @id @default(autoincrement())
  usuario_id       String   @db.Uuid
  modulo           String
  accion           String
  tabla_afectada   String
  registro_id      String
  datos_anteriores Json
  datos_nuevos     Json
  ip_origen        String
  user_agent       String
  fecha_accion     DateTime

  // Relaciones
  Usuarios Usuarios @relation(fields: [usuario_id], references: [usuario_id])
}

model Consultas_Veterinarias {
  consulta_id         Int      @id @default(autoincrement())
  animal_id           Int
  peso_actual         Decimal
  temperatura         Decimal
  motivo_consulta     String
  diagnostico         String
  tratamiento         String
  observaciones       String
  disponible_adopcion Boolean
  veterinario_id      String   @db.Uuid
  fecha_hora_consulta DateTime @default(now())

  // Relaciones
  Animal   Animales @relation(fields: [animal_id], references: [animal_id])
  Usuarios Usuarios @relation(fields: [veterinario_id], references: [usuario_id])
}

model Evaluaciones_Adopcion {
  evaluacion_id    Int      @id @default(autoincrement())
  animal_id        Int
  evaluador_id     String   @db.Uuid
  apto_adopcion    Boolean
  fecha_evaluacion DateTime
  aprobado_por     String   @db.Uuid
  fecha_aprobacion DateTime

  // Relaciones
  Animal    Animales @relation(fields: [animal_id], references: [animal_id])
  Evaluador Usuarios @relation("EvaluadorRelation", fields: [evaluador_id], references: [usuario_id])
  Aprobado  Usuarios @relation("AprobadoRelation", fields: [aprobado_por], references: [usuario_id])
}

model Desparasitaciones {
  desparacitaciones_id Int    @id @default(autoincrement())
  animal_id            Int
  producto_utilizado   String
  aplicado_por         String @db.Uuid

  // Relaciones
  Animal   Animales @relation(fields: [animal_id], references: [animal_id])
  Usuarios Usuarios @relation(fields: [aplicado_por], references: [usuario_id])
}

model Egresos_Animales {
  egreso_id         Int      @id @default(autoincrement())
  animal_id         Int
  tipo_egreso       String
  fecha_hora_egreso DateTime

  // Relaciones
  Animal Animales @relation(fields: [animal_id], references: [animal_id])
}

model Adopciones {
  adopcion_id    Int      @id @default(autoincrement())
  animal_id      Int
  adoptante_id   String   @db.Uuid
  fecha_adopcion DateTime
  costo_adopcion String
  evaluador_id   String   @db.Uuid

  // Relaciones
  Animal                 Animales                  @relation(fields: [animal_id], references: [animal_id])
  Adoptante              Propietario               @relation(fields: [adoptante_id], references: [propietario_id])
  Usuarios               Usuarios                  @relation(fields: [evaluador_id], references: [usuario_id])
  Seguimiento_Adopciones Seguimientos_Adopciones[]
}

model Seguimientos_Adopciones {
  seguimiento_id          Int      @id @default(autoincrement())
  adopcion_id             Int
  fecha_seguimiento       DateTime
  tipo_seguimiento        String
  condicion_seguimiento   String
  responsable_seguimiento String   @db.Uuid

  // Relaciones
  Adopcion    Adopciones @relation(fields: [adopcion_id], references: [adopcion_id])
  Responsable Usuarios   @relation(fields: [responsable_seguimiento], references: [usuario_id])
}

model Ingresos_Animales {
  ingreso_id         Int      @id @default(autoincrement())
  animal_id          Int
  tipo_ingreso       String
  fecha_hora_ingreso DateTime

  // Relaciones
  Animal Animales @relation(fields: [animal_id], references: [animal_id])
}

model Animales_Fotos {
  foto_id      Int     @id @default(autoincrement())
  animal_id    Int
  ruta_archivo String
  es_principal Boolean

  // Relaciones
  Animal Animales @relation(fields: [animal_id], references: [animal_id])
}

model Animales_Documentos {
  documento_id   Int    @id @default(autoincrement())
  animal_id      Int
  tipo_documento String
  nombre_archivo String

  // Relaciones
  Animal Animales @relation(fields: [animal_id], references: [animal_id])
}

model Mordeduras {
  mordedura_id          Int      @id @default(autoincrement())
  folio_mordedura       String   @unique
  animal_id             Int
  fecha_incidente       DateTime
  propietario_animal_id String   @db.Uuid
  registrador_por       String   @db.Uuid

  // Relaciones
  Animal      Animales    @relation(fields: [animal_id], references: [animal_id])
  Propietario Propietario @relation(fields: [propietario_animal_id], references: [propietario_id])
  Usuarios    Usuarios    @relation(fields: [registrador_por], references: [usuario_id])
}

model Propietario_Documentos {
  documento_id               Int    @id @default(autoincrement())
  propietario_id             String @db.Uuid
  tipo_documento_propietario String
  nombre_archivo             String
  ruta_archivo               String

  // Relaciones
  Propietario Propietario @relation(fields: [propietario_id], references: [propietario_id])
}

model Historial_Servicios_Propietario {
  historial_id     Int      @id @default(autoincrement())
  propietario_id   String   @db.Uuid
  tipo_servicio    String
  fecha_servicio   DateTime
  folio_referencia String

  // Relaciones
  Propietario Propietario @relation(fields: [propietario_id], references: [propietario_id])
}

model Pagos_Servicios {
  pago_id        Int      @id @default(autoincrement())
  folio_pago     String   @unique
  monto          Decimal
  metodo_pago    String
  estatus_pago   String
  propietario_id String   @db.Uuid
  fecha_pago     DateTime

  // Relaciones
  Propietario Propietario @relation(fields: [propietario_id], references: [propietario_id])
}

model Defunciones {
  defuncion_id            Int      @id @default(autoincrement())
  animal_id               Int
  fecha_hora_defuncion    DateTime
  lugar_defuncion         String
  causa_muerte            String
  veterinario_responsable String
  autopsia                Boolean
  disposicion_cadaver     String
  observaciones           String

  // Relaciones
  Animal      Animales      @relation(fields: [animal_id], references: [animal_id])
  Cremaciones Cremaciones[]
}

model Cremaciones {
  cremacion_id         Int      @id @default(autoincrement())
  defuncion_id         Int
  fecha_hora_cremacion DateTime
  numero_cremacion     String
  peso                 String
  operador_horno       String   @db.Uuid
  temperatura          String
  duracion             Int
  entrega_cenizas      String
  observaciones        String

  // Relaciones
  Defuncion Defunciones @relation(fields: [defuncion_id], references: [defuncion_id])
}

model Esterilizaciones {
  esterilizacion_id       Int      @id @default(autoincrement())
  folio_servicio          String   @unique
  animal_id               Int
  tipo                    String
  fecha_cirujia           DateTime
  metodo                  String
  complicaciones          String
  observaciones           String
  propietario_id          String   @db.Uuid
  veterinario_cirujano_id String   @db.Uuid

  // Relaciones
  Animal      Animales    @relation(fields: [animal_id], references: [animal_id])
  Propietario Propietario @relation(fields: [propietario_id], references: [propietario_id])
  Veterinario Usuarios    @relation(fields: [veterinario_cirujano_id], references: [usuario_id])
}

model Reporte_Seguimiento {
  seguimiento_id          Int    @id @default(autoincrement())
  reporte_id              Int
  tipo_accion_seguimiento String
  responsable_id          String @db.Uuid

  // Relaciones
  Reporte Reportes_Ciudadanos @relation(fields: [reporte_id], references: [reporte_id])
  Usuario Usuarios            @relation(fields: [responsable_id], references: [usuario_id])
}

model Folio_Seguimiento {
  id        Int      @id @default(autoincrement())
  tipo      String
  anio      Int
  ultimo    Int
  updatedAt DateTime @updatedAt

  @@unique([tipo, anio])
}

model Cat_Colonias {
  colonia_id     Int    @id @default(autoincrement())
  nombre_colonia String
}

enum Estatus_Usuario {
  ACTIVO
  INACTIVO
}
